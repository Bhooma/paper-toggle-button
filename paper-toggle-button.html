<!--
Copyright 2013 The Toolkitchen Authors. All rights reserved.
Use of this source code is governed by a BSD-style
license that can be found in the LICENSE file.
-->

<!--
/**
 * @group Quantum Paper Elements
 *
 * `paper-toggle-button` provides a ON/OFF switch that user can toggle the state
 * by tapping or by dragging the swtich.
 *
 * Example:
 *
 *    <paper-toggle-button></paper-toggle-button>
 *
 * @element paper-toggle-button
 * @homepage github.io
 */
-->

<link rel="import" href="../paper-radio-button/paper-radio-button.html">

<polymer-element name="paper-toggle-button" attributes="checked" touch-action="pan-y" role="button" aria-pressed="false" tabindex="0">

  <template>

    <link rel="stylesheet" href="paper-toggle-button.css">

    <div id="toggleContainer">
      <paper-radio-button id="toggleRadio" toggles checked="{{checked}}"
          on-trackstart="{{trackStart}}" on-track="{{track}}" on-trackend="{{trackEnd}}"></paper-radio-button>
      <div id="toggleBar"></div>
    </div>

  </template>
  
  <script>

    Polymer('paper-toggle-button', {

      /**
       * Gets or sets the state, `true` is checked and `false` is unchecked.
       *
       * @attribute checked
       * @type boolean
       * @default false
       */
      checked: false,

      trackStart: function(e) {
        this._w = this.$.toggleBar.offsetLeft + this.$.toggleBar.offsetWidth;
        e.preventTap();
      },

      track: function(e) {
        this._x = Math.min(this._w, 
            Math.max(0, this.checked ? this._w + e.dx : e.dx));
        this.$.toggleRadio.classList.add('dragging');
        var s =  this.$.toggleRadio.style;
        s.webkitTransform = s.transform = 'translate3d(' + this._x + 'px,0,0)';
      },

      trackEnd: function() {
        this.$.toggleRadio.style.webkitTransform = null;
        this.$.toggleRadio.classList.remove('dragging');
        this.checked = Math.abs(this._x) > this._w / 2;
        this.$.toggleRadio.resetInk();
      },

      checkedChanged: function() {
        this.setAttribute('aria-pressed', Boolean(this.checked));
      }

    });

  </script>

</polymer-element>
